---
title: "MX-DATA"
author: "Alan Yu"
date: "January 29, 2019"
output:
  pdf_document: default
  html_document: default
---

```{r}
#Something random
```

```{r}
#test 123
#test 12333
#Great meeting Let's call it a day!
```


```{r, warning = FALSE, message = FALSE}
#load the relevant libraries

library(ggplot2)
library(reshape2)
library(dplyr)
library(data.table)

data = read.csv("Mexican_Data_Combined.csv") 
#this mxdata.csv is the subset from my Alan_Data_Entry_1.xlsx containing P12s, Respondant_ID and Institution type I added to be used for labelling RP or MR.

subdata = as.data.frame(data)


#subset the columns that we want to use to analyze Question 12
subdata_12 = select(subdata, Respondent_ID, Institution_Type, P12_Distrito_1, P12_Distrito_2, P12_Distrito_3, P12_Distrito_4, P12_Distrito_5, P12_Distrito_6, P12_Distrito_7, P12_Distrito_8, P12_Distrito_9)

#then to make the graph we need to change Districts 1-9 to there corresponding competitiveness level

#rearrange data, # I use the melt function because we want the column names to be on the x-axis. We want to exlude anything that is not a district. 
subdata_12.melt = melt(subdata_12, id=c("Respondent_ID", "Institution_Type")) 

#Rename the districts to level of competitiveness and Institution Type to English abbreviation.
subdata_12.melt$variable = as.character(subdata_12.melt$variable)
subdata_12.melt$Institution_Type = as.character(subdata_12.melt$Institution_Type)
subdata_12.melt$variable[subdata_12.melt$variable == "P12_Distrito_1"] = "-.3"
subdata_12.melt$variable[subdata_12.melt$variable == "P12_Distrito_2"] = "-.4"
subdata_12.melt$variable[subdata_12.melt$variable == "P12_Distrito_3"] = "-.5"
subdata_12.melt$variable[subdata_12.melt$variable == "P12_Distrito_4"] = "-.1"
subdata_12.melt$variable[subdata_12.melt$variable == "P12_Distrito_5"] = "0"
subdata_12.melt$variable[subdata_12.melt$variable == "P12_Distrito_6"] = "-.1"
subdata_12.melt$variable[subdata_12.melt$variable == "P12_Distrito_7"] = "-.5"
subdata_12.melt$variable[subdata_12.melt$variable == "P12_Distrito_8"] = "-.4"
subdata_12.melt$variable[subdata_12.melt$variable == "P12_Distrito_9"] = "-.3"
subdata_12.melt$Institution_Type[subdata_12.melt$Institution_Type == "RP"] = "PR"
subdata_12.melt$Institution_Type[subdata_12.melt$Institution_Type == "MR"] = "SMD"

subdata_12.melt = subdata_12.melt[complete.cases(subdata_12.melt), ] #to remove NAs
subdata_12.melt = transform(subdata_12.melt, variable = as.numeric(variable)) #change variable from character to numerical

```

```{r}
ggplot(subdata_12.melt, aes(x = variable, y = value, color = Institution_Type)) + geom_jitter() + labs(x = "Margin of Vote", y = "Spending") + geom_smooth(method='lm', se = FALSE) + coord_cartesian(ylim = c(5000,20000)) + ggtitle("Mexican data") + labs(y="Spending", x = "Margin of Vote")

InstitutionTypeSubSet = split(subdata_12.melt, subdata_12.melt$Institution_Type)

#regression coefficients
lm(value ~ variable, data = InstitutionTypeSubSet$SMD)
lm(value ~ variable, data = InstitutionTypeSubSet$PR)
```

```{r american data without adjustment}
amdata = read.csv("Statalik_Multiple.csv")

amdata = as.data.frame(amdata)
keep = c("District_Spending", "Competitiveness", "Institution_Type")
amdata = (amdata[keep])
amdata$Competitiveness = abs(amdata$Competitiveness) #normalize the competitiveness
amdata$Competitiveness = -1 * (amdata$Competitiveness) #make all values negative

ggplot(amdata, aes(x = Competitiveness, y = District_Spending, color = Institution_Type)) + geom_jitter(width = .02) + geom_smooth(method='lm',se = FALSE) + coord_cartesian(ylim = c(5000,20000)) + ggtitle("US data") + labs(y="Spending", x = "Margin of Vote")

AMInstitutionTypeSubSet = split(amdata, amdata$Institution_Type)

#regression coefficients without adjustment
lm(District_Spending ~ Competitiveness, data = AMInstitutionTypeSubSet$SMD)
lm(District_Spending ~ Competitiveness, data = AMInstitutionTypeSubSet$PR)
```


```{r american data between 5000 and 50000, warning = FALSE, message = FALSE}
ggplot(amdata, aes(x = Competitiveness, y = District_Spending, color = Institution_Type)) + geom_jitter(width = .02) + geom_smooth(method='lm',se = FALSE) + ylim(5000,50000) + coord_cartesian(ylim = c(5000,20000)) + ggtitle("US data") + labs(y="Spending", x = "Margin of Vote")

AM_SMD = AMInstitutionTypeSubSet$SMD
AM_PR = AMInstitutionTypeSubSet$PR

#regression coefficients with adjustment
lm(District_Spending ~ Competitiveness, data = AM_SMD[AM_SMD$District_Spending>=5000 & AM_SMD$District_Spending<=50000,])
lm(District_Spending ~ Competitiveness, data = AM_PR[AM_PR$District_Spending>=5000 & AM_PR$District_Spending<=50000,])
```


```{r, warning = FALSE, message = FALSE}
#mexican data boxplot
ggplot(subdata_12.melt, aes(x = factor(variable), y = value, color = Institution_Type)) + geom_jitter() + labs(x = "Margin of Vote", y = "Spending") + geom_smooth(method='lm', se = FALSE) + geom_boxplot() + ggtitle("Mexican data") + labs(y="Spending", x = "Margin of Vote")

#american data boxplot with adjustment
ggplot(amdata, aes(x = factor(Competitiveness), y = District_Spending, color = Institution_Type)) + geom_jitter(width = .02) + geom_smooth(method='lm',se = FALSE) + ylim(5000,50000) + geom_boxplot() + ggtitle("US data") + labs(y="Spending", x = "Margin of Vote")

#american data boxplot without adjustment
ggplot(amdata, aes(x = factor(Competitiveness), y = District_Spending, color = Institution_Type)) + geom_jitter(width = .02) + geom_smooth(method='lm',se = FALSE) + geom_boxplot() + ggtitle("US data") + labs(y="Petal length (cm)", x = "Sepal length (cm)") + labs(y="Spending", x = "Margin of Vote")

```

```{r}

names(subdata_12.melt)[3]<-"Competitiveness"
names(subdata_12.melt)[4]<-"District_Spending"
all_data = rbind(subdata_12.melt[c("District_Spending", "Competitiveness", "Institution_Type")], amdata)

#combined data boxplot
ggplot(all_data, aes(x = factor(Competitiveness), y = District_Spending, color = Institution_Type)) + geom_jitter(width = .1) + geom_smooth(method='lm',se = FALSE) + geom_boxplot() + ggtitle("Pooled Data") + labs(y="Spending", x = "Margin of Vote")
```


